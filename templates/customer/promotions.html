{% extends 'customer/layout.html' %}
{% block title %}โปรโมชัน | TireWeb{% endblock %}
{% block content %}
<h1 class="text-2xl font-bold mb-4" style="color: #0c5e28;">โปรโมชัน</h1>
<nav class="text-gray-500 text-base mb-2 flex items-center flex-wrap" aria-label="Breadcrumb">
  <a href="/" class="font-bold text-[#0c5e28] hover:underline">หน้าแรก</a>
  <span class="mx-2">›</span>
  <span class="text-black text-sm max-w-xs truncate">โปรโมชัน</span>
</nav>

<!-- Carousel Container -->
<div class="relative w-full max-w-2xl mx-auto">
  <!-- Carousel Wrapper -->
  <div id="promotionsCarousel" class="relative overflow-hidden rounded-xl shadow-lg bg-white">
    <div id="carouselTrack" class="flex transition-transform duration-500 ease-in-out">
      {% for p in promotions %}
        <div class="carousel-slide w-full flex-shrink-0">
          <div class="relative">
            {% if p.image_url %}
              <a href="{{ url_for('customer.promotion_detail', promotion_id=p.promotion_id) }}" class="block cursor-pointer">
                <img src="{{ url_for('static', filename='uploads/promotions/' ~ p.image_url) }}" 
                     alt="{{ p.title }}" 
                     class="w-full h-auto object-contain hover:opacity-90 transition-opacity" />
              </a>
            {% else %}
              <a href="{{ url_for('customer.promotion_detail', promotion_id=p.promotion_id) }}" class="block cursor-pointer">
                <div class="w-full h-96 flex items-center justify-center bg-gradient-to-br from-green-100 to-green-200 text-gray-500 hover:opacity-90 transition-opacity">
                  <div class="text-center">
                    <svg class="w-16 h-16 mx-auto mb-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    <p class="text-sm">ไม่มีรูปภาพ</p>
                  </div>
                </div>
              </a>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
    
    <!-- Navigation Arrows -->
    <button id="prevBtn" class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-white/90 hover:bg-white text-green-900 rounded-full p-3 shadow-lg transition-all duration-300 hover:scale-110 z-10">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
    </button>
    
    <button id="nextBtn" class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-white/90 hover:bg-white text-green-900 rounded-full p-3 shadow-lg transition-all duration-300 hover:scale-110 z-10">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
      </svg>
    </button>
    
    <!-- Dots Indicator -->
    <div id="dotsContainer" class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2">
      {% for p in promotions %}
        <button class="dot w-3 h-3 rounded-full bg-white/50 hover:bg-white transition-colors duration-300" data-slide="{{ loop.index0 }}"></button>
      {% endfor %}
    </div>
  </div>
  
  <!-- No Promotions Message -->
  {% if not promotions %}
    <div class="text-center py-12">
      <svg class="w-16 h-16 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <h3 class="text-xl font-semibold text-gray-600 mb-2">ไม่มีโปรโมชันในขณะนี้</h3>
      <p class="text-gray-500">โปรดกลับมาใหม่ในภายหลัง</p>
    </div>
  {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const carousel = document.getElementById('promotionsCarousel');
  const track = document.getElementById('carouselTrack');
  const slides = document.querySelectorAll('.carousel-slide');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const dots = document.querySelectorAll('.dot');
  
  if (!carousel || slides.length === 0) return;
  
  let currentSlide = 0;
  let autoPlayInterval;
  const slideWidth = 100; // 100% width
  const autoPlayDelay = 3000; // 3 seconds
  
  // Set initial slide width
  slides.forEach(slide => {
    slide.style.width = `${slideWidth}%`;
  });
  
  // Update track position
  function updateTrack() {
    track.style.transform = `translateX(-${currentSlide * slideWidth}%)`;
  }
  
  // Update dots
  function updateDots() {
    dots.forEach((dot, index) => {
      if (index === currentSlide) {
        dot.classList.add('bg-white');
        dot.classList.remove('bg-white/50');
      } else {
        dot.classList.remove('bg-white');
        dot.classList.add('bg-white/50');
      }
    });
  }
  
  // Go to specific slide
  function goToSlide(index) {
    currentSlide = index;
    updateTrack();
    updateDots();
  }
  
  // Next slide
  function nextSlide() {
    currentSlide = (currentSlide + 1) % slides.length;
    updateTrack();
    updateDots();
  }
  
  // Previous slide
  function prevSlide() {
    currentSlide = (currentSlide - 1 + slides.length) % slides.length;
    updateTrack();
    updateDots();
  }
  
  // Start autoplay
  function startAutoPlay() {
    autoPlayInterval = setInterval(nextSlide, autoPlayDelay);
  }
  
  // Stop autoplay
  function stopAutoPlay() {
    if (autoPlayInterval) {
      clearInterval(autoPlayInterval);
    }
  }
  
  // Event listeners
  prevBtn.addEventListener('click', () => {
    prevSlide();
    stopAutoPlay();
    startAutoPlay();
  });
  
  nextBtn.addEventListener('click', () => {
    nextSlide();
    stopAutoPlay();
    startAutoPlay();
  });
  
  // Dot navigation
  dots.forEach((dot, index) => {
    dot.addEventListener('click', () => {
      goToSlide(index);
      stopAutoPlay();
      startAutoPlay();
    });
  });
  
  // Pause on hover
  carousel.addEventListener('mouseenter', stopAutoPlay);
  carousel.addEventListener('mouseleave', startAutoPlay);
  
  // Keyboard navigation
  document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft') {
      prevSlide();
      stopAutoPlay();
      startAutoPlay();
    } else if (e.key === 'ArrowRight') {
      nextSlide();
      stopAutoPlay();
      startAutoPlay();
    }
  });
  
  // Touch/swipe support
  let startX = 0;
  let endX = 0;
  
  carousel.addEventListener('touchstart', (e) => {
    startX = e.touches[0].clientX;
  });
  
  carousel.addEventListener('touchend', (e) => {
    endX = e.changedTouches[0].clientX;
    const diff = startX - endX;
    
    if (Math.abs(diff) > 50) { // Minimum swipe distance
      if (diff > 0) {
        nextSlide();
      } else {
        prevSlide();
      }
      stopAutoPlay();
      startAutoPlay();
    }
  });
  
  // Initialize
  updateDots();
  startAutoPlay();
});
</script>

<style>
.line-clamp-2 {
  display: -webkit-box;
  display: -moz-box;
  display: box;
  -webkit-line-clamp: 2;
  -moz-line-clamp: 2;
  line-clamp: 2;
  -webkit-box-orient: vertical;
  -moz-box-orient: vertical;
  box-orient: vertical;
  overflow: hidden;
}

.carousel-slide {
  transition: all 0.3s ease;
}

#carouselTrack {
  transition: transform 0.5s ease-in-out;
}
</style>
{% endblock %} 